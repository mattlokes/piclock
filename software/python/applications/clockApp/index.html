<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Matt's RGB WordClock</title>

    <!-- Bootstrap core CSS -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="/navmenu/css/jasny-bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/navmenu/css/navmenu-push.css" rel="stylesheet">

  </head>

  <body>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    
    <!-- NavMenu -->
    <script type="text/javascript" src="/includes/navmenu.js"> </script>    
    
    <!-- Status Body -->
    <div class="container">
      <div class="page-header">
        <h1>Clock</h1>
      </div>

      <div class="row">
        <div class="col-xs-4">
          <p class="lead">Colour: <br><br><br><input type="text" id="col" name="color" size="7" value="#00FFFF" /></p>
        </div>
        <script type="text/javascript" src="/farbtastic/farbtastic.js"></script>
        <link rel="stylesheet" href="/farbtastic/farbtastic.css" type="text/css" />
        <div class="col-xs-8">
          <div id="colorpicker"></div>
        </div>
        <script type="text/javascript">
          $(document).ready(function() { $('#colorpicker').farbtastic('#col'); });
        </script>
      </div>
      <div><hr></div>

      <div class="row">
        <div class="col-xs-3">
          <label class="lead">Mode: </label>
        </div>
        <label for="mode" class="control-label input-group"></label>
        <div class="btn-group col-xs-9" data-toggle="buttons">
          <label class="btn btn-default active">
            <input type="radio" name="mode" id="mode_word" checked="">Word
          </label>
          <label class="btn btn-default">
            <input type="radio" name="mode" id="mode_dig0">Digital
          </label>
          <label class="btn btn-default">
            <input type="radio" name="mode" id="mode_dig2">Big Digital
          </label>
        </div>
      </div>
      <div><hr></div>

      <div class="row">
        <div class="col-xs-3">
          <p class="lead">Suffix Words*:</p>
        </div>
        <div class="col-xs-9">
          <input type="checkbox" id="suffix" ></p>
        </div>
        <link href="/bootstrap-switch/bootstrap-switch.css" rel="stylesheet">
        <script src="/bootstrap-switch/bootstrap-switch.js"></script>
        <script type="text/javascript"> $("#suffix").bootstrapSwitch(); </script>
      </div>
      <div><hr></div>
      
      <div class="row">
        <div class="col-xs-3">
          <p class="lead">AM/PM*:</p>
        </div>
        <div class="col-xs-9">
          <input type="checkbox" id="ampm" >
        </div>
        <script type="text/javascript"> $("#ampm").bootstrapSwitch(); </script>
      </div>
      <div><hr></div>
      
      <div class="row">
        <div class="col-xs-3">
          <label class="lead">Transition: </label>
        </div>
        <label for="tran" class="control-label input-group"></label>
        <div class="btn-group col-xs-9" data-toggle="buttons">
          <label class="btn btn-default active">
            <input type="radio" name="tran" id="tran_none" checked="">None
          </label>
          <label class="btn btn-default">
            <input type="radio" name="tran" id="tran_hslide">HSlide
          </label>
          <label class="btn btn-default">
            <input type="radio" name="tran" id="tran_vslide">VSlide
          </label>
        </div>
      </div>
      <div><hr></div>
 
      <div class="row">
        <div> *Only available in Word mode </div>
        <div id="output"></div>
        <hr>  
      </div>
        <!--<script type="text/javascript" src="/jscolor/jscolor.js"></script>
        Click here: <input class="color" id="col" value="00ff00"> -->
    </div>

    <!-- JS for Page -->
    <script type="text/javascript"> document.getElementById("nav-clock").className += "active"; </script>

<script type="text/javascript" src="http://l2.io/ip.js?var=myip"></script>
<script>
var wsUri;
var output;
var colval = document.getElementById('col').value;
var modeVal = "";
var tranVal = "";
var todVal = "";
var nInit = 0;
var sendTimerObj;
var DEPRICATE = 1;

function init()
{ 
  output = document.getElementById("output");
  //set wsUri to location.host
  wsUri = "ws://" + location.hostname + ":5005/ws";
  testWebSocket();
}

function testWebSocket()
{ 
  websocket = new WebSocket(wsUri);
  websocket.onopen = function(evt) { onOpen(evt) };
  websocket.onclose = function(evt) { onClose(evt) };
  websocket.onmessage = function(evt) { onMessage(evt) };
  websocket.onerror = function(evt) { onError(evt) }; 
}

function timerfun()
{
  if(document.getElementById('col').value != colval)
  { 
    colval = document.getElementById('col').value;
    //document.getElementById('col').value = colval;
    doSend("#CLOCK#COLOR#"+colval.split("#")[1]+"#");
  }
 
  var tmpMode;
  if(document.getElementById('mode_word').checked) { tmpMode = "WORD"; }
  if(document.getElementById('mode_dig0').checked) { tmpMode = "DIG0"; }
  if(document.getElementById('mode_dig2').checked) { tmpMode = "DIG2"; }
  if(tmpMode != modeVal)
  {
    modeVal = tmpMode;
    doSend("#CLOCK#MODE#"+modeVal+"#");
  }

  var tmpTod = "NONE";
  if(document.getElementById('suffix').checked) { tmpTod = "SUFFIX"; }
  if(document.getElementById('ampm').checked) { tmpTod = "AMPM"; }
  if(tmpTod != todVal)
  {
    todVal = tmpTod;
    doSend("#CLOCK#TOD#"+todVal+"#");
  }
  
  var tmpTran;
  if(document.getElementById('tran_none').checked) { tmpTran = "NONE"; }
  if(document.getElementById('tran_hslide').checked) { tmpTran = "HSLIDE"; }
  if(document.getElementById('tran_vslide').checked) { tmpTran = "VSLIDE"; }
  if(tmpTran != tranVal)
  {
    tranVal = tmpTran;
    doSend("#CLOCK#TRAN#"+tranVal+"#");
  }

  
}

function onOpen(evt) 
{ 
  //writeToScreen(myip); 
  doSend("#"+myip);
  doSend("#MAIN#SWITCH#CLOCK#");
  if(DEPRICATE) sendTimerObj = setInterval(timerfun,30); 
}  

function onClose(evt)
{ 
  //writeToScreen("DISCONNECTED"); 
}

function onMessage(evt) 
{ 
  if( (evt.data[0] == "(") &&
      (evt.data[4] == ",") &&
      (evt.data[8] == ")")) {
    //Input Coord
    var cur_yaw   = parseInt(evt.data.slice(1,4));
    var cur_pitch = parseInt(evt.data.slice(5,8));
    
    document.getElementById('yaw').value      = cur_yaw;
    document.getElementById('yawval').value   = cur_yaw;
    document.getElementById('pitch').value    = cur_pitch;
    document.getElementById('pitchval').value = cur_pitch;
   
    if(nInit == 0) { 
      sendTimerObj = setInterval(timerfun,30);
      nInit = 1;
    }
  }
  //writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
  //websocket.close(); 
}

function onError(evt) 
{ 
  writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data + " DISPLAY OFFLINE?");
} 

function doSend(message) 
{
  //writeToScreen("SENT: " + message);
  websocket.send(message);
}

function writeToScreen(message) 
{
  var pre = document.createElement("p");
  pre.style.wordWrap = "break-word";
  pre.innerHTML = message;
  output.appendChild(pre);
}

window.addEventListener("load", init, false);
</script>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script> -->
    <!-- <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script> -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script src="/navmenu/js/jasny-bootstrap.min.js"></script>
  </body>
</html>
